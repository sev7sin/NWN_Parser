<Window x:Class="WatcherNWNApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WatcherNWNApp"
        mc:Ignorable="d"
        Title="AetherLens" Height="650" Width="1100" MinHeight="500" MinWidth="900"
        Background="#1c1c1c" Foreground="White">
    <Window.Resources>
        <!-- Explicit ComboBoxItem style to avoid ancestor bindings that can throw when items are recycled -->
        <Style x:Key="DarkComboBoxItemStyle" TargetType="ComboBoxItem">
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Background" Value="#2a2a2a"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#3a3a3a"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#4a4a4a"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="#2a2a2a"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3a3a3a"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="ItemContainerStyle" Value="{StaticResource DarkComboBoxItemStyle}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Name="ToggleButton"
                                          BorderBrush="{TemplateBinding BorderBrush}"
                                          BorderThickness="{TemplateBinding BorderThickness}"
                                          Background="{TemplateBinding Background}"
                                          Foreground="{TemplateBinding Foreground}"
                                          Grid.Column="2"
                                          Focusable="False"
                                          IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"
                                          Padding="4,2">
                                <TextBlock Text="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}"
                                           Foreground="{TemplateBinding Foreground}"
                                           Margin="4,0,24,0"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Left"/>
                            </ToggleButton>
                            <Popup Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border Background="#2a2a2a" BorderBrush="#3a3a3a" BorderThickness="1" CornerRadius="0,0,4,4"/>
                                    <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="ToggleButton" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#2f2f2f"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3a3a3a"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>
    <Grid Margin="10" Background="#1c1c1c">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel Orientation="Horizontal" Grid.Column="0">
                <Button x:Name="btnSelectFile" Content="Select File" Width="100" Height="30" Click="BtnSelectFile_Click" Background="#2a2a2a" Foreground="White"/>
                <TextBlock x:Name="txtStatus" Text="Idle" Margin="10,0,0,0" VerticalAlignment="Center" TextWrapping="WrapWithOverflow" />
            </StackPanel>
            <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                <TextBlock x:Name="txtPlayerAuto" Text="Auto: -" HorizontalAlignment="Right"/>
                <ComboBox x:Name="cmbPlayer" Width="180" IsEditable="True" SelectionChanged="CmbPlayer_SelectionChanged" LostKeyboardFocus="CmbPlayer_LostKeyboardFocus" Background="#2a2a2a" Foreground="White" ToolTip="Pick or type your player character name. Drives DPS/damage tracking and filters out self from monsters."/>
            </StackPanel>
        </Grid>

        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center">
            <TextBlock Text="Buffs:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <TextBlock Text="Remaining:" FontWeight="Bold" Margin="0,0,4,0" VerticalAlignment="Center"/>
            <TextBlock x:Name="txtTimerDisplay" Text="--:--" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
        </StackPanel>

        <TabControl Grid.Row="2" Background="#1f1f1f">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Background" Value="#2a2a2a"/>
                    <Setter Property="BorderBrush" Value="#2f2f2f"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Padding" Value="8,4"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="Bd" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4,4,0,0" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter ContentSource="Header" RecognizesAccessKey="True" HorizontalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="#3a3a3a"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Foreground" Value="#777777"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>
            <TabItem Header="Combat">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Combat:" FontWeight="Bold" Margin="0,0,6,0"/>
                        <ComboBox x:Name="cmbCombat" Width="220" SelectionChanged="CmbCombat_SelectionChanged" Background="#2a2a2a" Foreground="White" ToolTip="Select a combat session to view"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Started:" FontWeight="Bold" Margin="0,0,6,0"/>
                        <TextBlock x:Name="txtCombatStart" Text="-" Margin="0,0,12,0"/>
                        <TextBlock Text="Duration:" FontWeight="Bold" Margin="0,0,6,0"/>
                        <TextBlock x:Name="txtCombatDuration" Text="-" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Total Damage:" FontWeight="Bold" Margin="0,0,6,0" Foreground="Gold" FontSize="14"/>
                        <TextBlock x:Name="txtTotalDamage" Text="0" Margin="0,0,12,0" Foreground="Gold" FontSize="14" FontWeight="Bold"/>
                        <TextBlock Text="Total DPS:" FontWeight="Bold" Margin="0,0,6,0" Foreground="Gold" FontSize="14"/>
                        <TextBlock x:Name="txtTotalDps" Text="0" Margin="0,0,12,0" Foreground="Gold" FontSize="14" FontWeight="Bold"/>
                        <TextBlock Text="Total Healing:" FontWeight="Bold" Margin="0,0,6,0" Foreground="Lime"/>
                        <TextBlock x:Name="txtTotalHealing" Text="0" Foreground="Lime"/>
                        <TextBlock x:Name="txtTotalDamageTaken" Text="-" Foreground="Red" FontWeight="Bold" FontSize="14" Margin="12,0,0,0"/>
                    </StackPanel>
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="combatItems">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="5"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="#444" Background="#252525" BorderThickness="1" CornerRadius="4" Margin="4" Padding="6">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4"/>
                                                <TextBlock Text="{Binding DamageText}" TextWrapping="Wrap" Foreground="Gold" FontSize="13" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding DpsText}" TextWrapping="Wrap" Foreground="Gold" FontSize="13" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Summary}" TextWrapping="Wrap"/>
                                                <TextBlock Text="{Binding DamageTakenText}" TextWrapping="Wrap" Foreground="{Binding DamageTakenBrush}" FontSize="13" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Entities">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="0,10,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Margin="0,0,0,10">
                            <TextBlock Text="Entities" FontWeight="Bold" Margin="0,0,0,4"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                                <ComboBox x:Name="cmbEntities" Width="240" SelectionChanged="CmbEntities_SelectionChanged" Background="#2a2a2a" Foreground="White" ToolTip="Pick an entity to view known stats"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="12,0,0,0">
                                    <Button x:Name="btnResetEntity" Content="Reset" Width="80" Height="26" Margin="0,0,8,0" Click="BtnResetEntity_Click" Background="#2a2a2a" Foreground="White" ToolTip="Reset stats for the selected entity"/>
                                    <Button x:Name="btnDeleteEntity" Content="Delete" Width="80" Height="26" Click="BtnDeleteEntity_Click" Background="#772a2a" Foreground="White" ToolTip="Delete the selected entity and its data"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,4">
                                <TextBlock Text="Overall Dice Average:" FontWeight="Bold" Margin="0,0,6,0"/>
                                <TextBlock x:Name="txtOverallDiceAverage" Text="-" Margin="0,0,12,0"/>
                                <Button x:Name="btnClearAllDice" Content="Clear All Dice" Width="120" Height="26" Click="BtnClearAllDice_Click" Background="#2a2a2a" Foreground="White" ToolTip="Reset all dice stats and last-roll timestamp"/>
                                <TextBlock Text="Last roll:" FontWeight="Bold" Margin="12,0,4,0"/>
                                <TextBlock x:Name="txtLastRollTimestamp" Text="-" />
                            </StackPanel>
                        </StackPanel>

                        <Border Grid.Row="2" Padding="10" BorderThickness="1" BorderBrush="#444" Background="#252525" CornerRadius="4">
                            <StackPanel>
                                <TextBlock x:Name="txtEntityName" FontSize="16" FontWeight="Bold" Text="Select an entity" Margin="0,0,0,8"/>
                                <TextBlock x:Name="txtAcStats" Text="AC: -" Margin="0,0,0,4"/>
                                <TextBlock x:Name="txtTouchStats" Text="Touch AC: -" Margin="0,0,0,4"/>
                                <TextBlock x:Name="txtSr" Text="Spell Resistance: -" Margin="0,0,0,4"/>
                                <TextBlock x:Name="txtConcealment" Text="Concealment: -" Margin="0,0,0,8"/>
                                <TextBlock x:Name="txtDiceAverage" Text="Dice Average: -" Margin="0,0,0,8"/>
                                <TextBlock Text="Seen" FontWeight="Bold" Margin="0,0,0,4"/>
                                <TextBlock x:Name="txtFirstSeen" Text="First seen: -" Margin="0,0,0,4"/>
                                <TextBlock x:Name="txtLastSeen" Text="Last seen: -" Margin="0,0,0,8"/>
                                <TextBlock Text="Spells" FontWeight="Bold" Margin="0,0,0,4"/>
                                <TextBlock x:Name="txtSpells" Text="-" TextWrapping="Wrap" Margin="0,0,0,8"/>
                                <TextBlock Text="Abilities" FontWeight="Bold" Margin="0,0,0,4"/>
                                <TextBlock x:Name="txtAbilities" Text="-" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Social">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10,0,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,10">
                            <Button x:Name="btnLoadSocial" Content="Load" Width="70" Height="24" Margin="0,0,8,0" Click="BtnLoadSocial_Click" Background="#2a2a2a" Foreground="White" ToolTip="Load social data from file"/>
                            <Button x:Name="btnNewSocial" Content="New" Width="70" Height="24" Click="BtnNewSocial_Click" Background="#2a2a2a" Foreground="White" ToolTip="Create a new social data file"/>
                        </StackPanel>

                        <Grid Grid.Row="1" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Orientation="Vertical">
                                <TextBlock Text="Recent speakers" FontWeight="Bold" Margin="0,0,0,4"/>
                                <ItemsControl x:Name="recentTalkItems">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Content="{Binding}" Margin="0,0,6,6" Padding="6,2" Click="RecentTalkButton_Click" Background="#2a2a2a" Foreground="White"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">
                                <TextBlock Text="File:" FontWeight="Bold" Margin="0,0,6,0"/>
                                <TextBlock x:Name="txtSocialFileName" Text="-" />
                            </StackPanel>
                        </Grid>

                        <StackPanel Orientation="Horizontal" Grid.Row="2" Margin="0,0,0,10">
                            <TextBlock Text="Profiles" FontWeight="Bold" Margin="0,0,6,0" VerticalAlignment="Center"/>
                            <ComboBox x:Name="cmbSocial" Width="240" SelectionChanged="CmbSocial_SelectionChanged" ToolTip="Select a social profile"/>
                            <TextBlock Text="Search:" FontWeight="Bold" Margin="12,0,6,0" VerticalAlignment="Center"/>
                            <TextBox x:Name="txtSocialSearch" Width="180" Margin="0,0,12,0" TextChanged="TxtSocialSearch_TextChanged" ToolTip="Search by name or alias"/>
                        </StackPanel>

                        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,10">
                            <CheckBox x:Name="chkHaveMet" Content="Have met" Margin="0,0,16,0" Checked="SocialCheckChanged" Unchecked="SocialCheckChanged" ToolTip="Mark that you've met this character"/>
                            <CheckBox x:Name="chkKnowName" Content="Know name" Margin="0,0,16,0" Checked="SocialCheckChanged" Unchecked="SocialCheckChanged" ToolTip="Mark that you know this character's name"/>
                            <TextBlock Text="Alias:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBox x:Name="txtAlias" Width="160" TextChanged="TxtAlias_TextChanged" ToolTip="Custom alias for this character"/>
                        </StackPanel>

                        <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="First seen:" FontWeight="Bold" Margin="0,0,6,0"/>
                            <TextBlock x:Name="txtSocialFirstSeen" Text="-" />
                        </StackPanel>

                        <StackPanel Grid.Row="5" Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Last seen:" FontWeight="Bold" Margin="0,0,6,0"/>
                            <TextBlock x:Name="txtSocialLastSeen" Text="-" />
                        </StackPanel>

                        <StackPanel Grid.Row="6" Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Other chars (same user):" FontWeight="Bold" Margin="0,0,6,0"/>
                            <TextBlock x:Name="txtSocialRelated" Text="-" />
                        </StackPanel>

                        <StackPanel Grid.Row="7" Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Users:" FontWeight="Bold" Margin="0,0,6,0"/>
                            <TextBlock x:Name="txtSocialUsers" Text="-" />
                        </StackPanel>

                        <StackPanel Grid.Row="8" HorizontalAlignment="Left" MaxWidth="600">
                            <TextBlock Text="Notes" FontWeight="Bold" Margin="0,0,0,4"/>
                            <TextBox x:Name="txtSocialNotes" AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" Height="120" Width="580" ToolTip="Free-form notes (click Save to store)" TextChanged="TxtSocialNotes_TextChanged"/>
                            <Button x:Name="btnSaveSocial" Content="Save" Width="80" Height="24" Margin="0,6,0,0" HorizontalAlignment="Right" Click="BtnSaveSocial_Click" Background="#2a2a2a" Foreground="White"/>
                        </StackPanel>

                        <StackPanel Grid.Row="9" Orientation="Vertical" Margin="0,10,0,0">
                            <TextBlock Text="Spells (entity)" FontWeight="Bold" Margin="0,0,0,4"/>
                            <ItemsControl x:Name="spellsItems">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" Margin="0,0,0,4"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Reminders">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10,0,0,0">
                        <Border BorderBrush="#444" BorderThickness="1" Background="#252525" CornerRadius="4" Padding="10" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="Buff Timer" FontWeight="Bold" Margin="0,0,0,6"/>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Duration:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <ComboBox x:Name="cmbTimerDuration" Width="140" Background="#2a2a2a" Foreground="White" Margin="0,0,8,0"/>
                                    <TextBlock Text="Ping at:" VerticalAlignment="Center" Margin="8,0,6,0"/>
                                    <ComboBox x:Name="cmbTimerPreAlert" Width="140" Background="#2a2a2a" Foreground="White"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="btnStartTimer" Content="Start" Width="70" Height="26" Click="BtnStartTimer_Click" Background="#2a2a2a" Foreground="White" Margin="0,0,8,0"/>
                                    <Button x:Name="btnPauseTimer" Content="Pause" Width="70" Height="26" Click="BtnPauseTimer_Click" Background="#2a2a2a" Foreground="White" Margin="0,0,8,0"/>
                                    <Button x:Name="btnStopTimer" Content="Stop" Width="70" Height="26" Click="BtnStopTimer_Click" Background="#2a2a2a" Foreground="White" Margin="0,0,8,0"/>
                                    <Button x:Name="btnResetTimer" Content="Reset" Width="70" Height="26" Click="BtnResetTimer_Click" Background="#2a2a2a" Foreground="White"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <TextBlock Text="Volume:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <Slider x:Name="sliderVolume" Width="160" Minimum="0" Maximum="1" TickFrequency="0.1" IsSnapToTickEnabled="True" ValueChanged="SliderVolume_ValueChanged"/>
                                    <TextBlock x:Name="txtVolumeValue" Text="50%" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <CheckBox x:Name="chkTimerAutoStart" Content="Start timer on cast" VerticalAlignment="Center" Margin="0,0,8,0" Checked="TimerAutoStartCheckChanged" Unchecked="TimerAutoStartCheckChanged" ToolTip="Automatically start the timer when this text appears in chat"/>
                                    <TextBox x:Name="txtTimerAutoStart" Width="220" Background="#2a2a2a" Foreground="White" TextChanged="TimerAutoStartTextChanged" IsEnabled="{Binding IsChecked, ElementName=chkTimerAutoStart}" ToolTip="Text to look for in chat (case-insensitive)"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Button x:Name="btnAddReminder" Content="Add" Width="80" Height="24" Click="BtnAddReminder_Click" Background="#2a2a2a" Foreground="White" ToolTip="Add a new reminder entry"/>
                            <Button x:Name="btnClearReminders" Content="Clear All" Width="90" Height="24" Margin="8,0,0,0" Click="BtnClearReminders_Click" Background="#2a2a2a" Foreground="White" ToolTip="Remove all reminders (prompts for confirmation)"/>
                            <TextBlock Text="Text Reminders" VerticalAlignment="Center" Margin="12,0,0,0" ToolTip="Reminders trigger when their text appears in the log"/>
                            <TextBlock x:Name="txtReminderSummary" VerticalAlignment="Center" Margin="12,0,0,0" ToolTip="Shows how many reminders are active vs total (active = enabled and non-empty)"/>
                        </StackPanel>
                        <ItemsControl x:Name="reminderItems" ScrollViewer.VerticalScrollBarVisibility="Auto" MaxHeight="220">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,0,0,6">
                                        <Grid.Resources>
                                            <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                                <Setter Property="Background" Value="#2f2f2f"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Grid}}" Value="True">
                                                        <Setter Property="Background" Value="#3a3f46"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsMouseOver, ElementName=chkCase}" Value="True">
                                                        <Setter Property="Background" Value="#3a3f46"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsMouseOver, ElementName=chkWhole}" Value="True">
                                                        <Setter Property="Background" Value="#3a3f46"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsMouseOver, ElementName=btnRemove}" Value="True">
                                                        <Setter Property="Background" Value="#3a3f46"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsMouseOver, ElementName=chkEnabled}" Value="True">
                                                        <Setter Property="Background" Value="#3a3f46"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Resources>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <CheckBox x:Name="chkEnabled" Grid.Column="0" IsChecked="{Binding Enabled, Mode=TwoWay}" VerticalAlignment="Center" Margin="0,0,8,0" Checked="ReminderCheckChanged" Unchecked="ReminderCheckChanged" ToolTip="Toggle this reminder on/off"/>
                                        <TextBox x:Name="txtReminder" Grid.Column="1" Text="{Binding Text, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="240" HorizontalAlignment="Left" Margin="0,0,8,0" TextChanged="ReminderTextChanged" ToolTip="Text to match in the log (autosaves)"/>
                                        <TextBlock Grid.Column="2" Margin="0,0,12,0" TextWrapping="Wrap" VerticalAlignment="Center" Visibility="{Binding HasMatch, Converter={StaticResource BoolToVis}}">
                                            <Run Text="{Binding LastMatchPrefix, Mode=OneWay}" Foreground="Gold"/>
                                            <Run Text="{Binding LastMatchMatch, Mode=OneWay}" Foreground="Red"/>
                                            <Run Text="{Binding LastMatchSuffix, Mode=OneWay}" Foreground="Gold"/>
                                        </TextBlock>
                                        <CheckBox x:Name="chkCase" Grid.Column="3" Content="Case" IsChecked="{Binding CaseSensitive, Mode=TwoWay}" VerticalAlignment="Center" Margin="0,0,8,0" Checked="ReminderCheckChanged" Unchecked="ReminderCheckChanged" ToolTip="Case-sensitive match. Example: 'Fire' matches 'Fireball' but not 'fireball'. Disable to match both."/>
                                        <CheckBox x:Name="chkWhole" Grid.Column="4" Content="Whole word" IsChecked="{Binding WholeWord, Mode=TwoWay}" VerticalAlignment="Center" Margin="0,0,8,0" Checked="ReminderCheckChanged" Unchecked="ReminderCheckChanged" ToolTip="Whole-word match only. Example: 'haste' matches 'You cast haste', but not 'chastened'. Disable to match substrings."/>
                                        <Button x:Name="btnRemove" Grid.Column="5" Content="X" Width="28" Height="24" Click="BtnRemoveReminder_Click" Background="#2a2a2a" Foreground="White" ToolTip="Remove this reminder"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
